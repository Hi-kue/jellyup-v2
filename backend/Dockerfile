FROM python:latest AS base

WORKDIR /app

COPY . /app

RUN apt-get update && apt-get install -y  --no-install-recommends \
    build-essential \
    ffmpeg
RUN pip install --no-cache-dir -r requirements.txt

ARG OPENAI_API_KEY
ARG DATABASE_URL
ARG DIRECT_URL
ARG NEXT_PUBLIC_SUPABASE_URL
ARG NEXT_PUBLIC_SUPABASE_ANON

ENV FLASK_APP=app.py
ENV FLASK_ENV=development
ENV OPENAI_API_KEY=$OPENAI_API_KEY
ENV DATABASE_URL=$DATABASE_URL
ENV DIRECT_URL=$DIRECT_URL
ENV NEXT_PUBLIC_SUPABASE_URL=$NEXT_PUBLIC_SUPABASE_URL
ENV NEXT_PUBLIC_SUPABASE_ANON=$NEXT_PUBLIC_SUPABASE_ANON

EXPOSE 5000

CMD ["python", "app.py"]